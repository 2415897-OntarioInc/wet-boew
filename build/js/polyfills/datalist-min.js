/*!
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * www.tbs.gc.ca/ws-nw/wet-boew/terms / www.sct.gc.ca/ws-nw/wet-boew/conditions
 */
(function(a){a.fn.datalist=function(){return a(this).each(function(e){var f=a(this),i=a("#"+f.attr("list")),d,j,c=[],g,h,b;g=function(m){var k=m.toLowerCase(),l=j.filter(function(){var o=a(this),n=o.find("span.al-value").html();if(n.length===0){n=o.find("span.al-label").html()}return(k.length===0||n.toLowerCase().indexOf(k)===0)});j.not(l).addClass("al-hide");l.removeClass("al-hide");if(l.length!==0){d.removeClass("al-hide");f.attr("aria-expanded","true")}else{d.addClass("al-hide");f.attr("aria-expanded","false")}};h=function(){b.css("min-width",f.innerWidth());if(pe.ie>0&&pe.ie<8){d.css("top",f.innerHeight()+13)}};pe.resize(h);i.find("option").each(function(n){var m=a(this),l=m.attr("value"),k=m.attr("label");if(l==="undefined"){l=m.text()}c.push('<li class="al-hide al-option" id="al-option-'+e+"-"+n+'"><a href="javascript:;"><span class="al-value">'+(l!=="undefined"?l:"")+'</span><span class="al-label">'+(k!=="undefined"?k:"")+"</span></a></li>")});f.attr({role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":"wb-autolist-"+e}).wrap('<div class="wb-al-container"/>');b=f.parent().css("min-width",f.innerWidth());d=a('<ul role="listbox" id="wb-autolist-'+e+'" class="wb-autolist al-hide">'+c.join("")+"</ul>");j=d.find("li");f.after(d);if(pe.ie>0&&pe.ie<8){d.css("top",f.innerHeight()+13)}f.on("keyup keydown click vclick",function(p){var n=p.type,l=p.keyCode,o=p.target,k=j.filter(":not(.al-hide)"),m;if(n==="keyup"){if(!(p.ctrlKey||p.altKey||p.metaKey)){if((l>47&&l<58)||(l>64&&l<91)||l===32||l===8){g(f.val())}}}else{if(n==="keydown"){if(!(p.ctrlKey||p.metaKey)){if(!p.altKey&&f.attr("aria-expanded")==="true"){if(l===9||l===27){g("~!!@@#$");f.removeAttr("aria-activedescendent");if(l===27){return false}}else{if(l===38||l===40){k=j.filter(":not(.al-hide)").find("a");if(k.length>0){e=k.index(o);if(l===38){m=k.last()}else{m=k.eq(0)}pe.focus(m);f.attr("aria-activedescendent",m.attr("id"))}return false}}}else{if(l===38||l===40){g("");return false}}}}else{if(n==="click"||n==="vclick"){if(f.attr("aria-expanded")==="true"){g("~!!@@#$")}else{g("")}return false}}}});d.on("keyup keydown click vclick","li, span",function(n){var q=n.type,p=n.keyCode,o=a(n.target),k,m,s,l=f.val(),r;if(q==="keyup"){if(!(n.ctrlKey||n.altKey||n.metaKey)){if((p>47&&p<58)||(p>64&&p<91)||p===32){f.val(l+String.fromCharCode(p));pe.focus(f);g(f.val())}else{if(p===8){if(f.val().length>0){f.val(l.substring(0,l.length-1));g(f.val())}pe.focus(f)}}}}else{if(q==="keydown"){if(!(n.ctrlKey||n.altKey||n.metaKey)){if(p===13){r=o.find("span.al-value").html();if(r.length===0){r=o.find("span.al-label").html()}f.val(r);pe.focus(f);g("~!!@@#$");return false}else{if(p===9||p===27){pe.focus(f);g("~!!@@#$");f.removeAttr("aria-activedescendent");if(p===27){return false}}else{if(p===38||p===40){k=j.filter(":not(.al-hide)").find("a");if(k.length>0){m=k.index(o);if(p===38){s=((m-1)===-1?k.last():k.eq(m-1))}else{s=((m+1)===k.length?k.eq(0):k.eq(m+1))}pe.focus(s);f.attr("aria-activedescendent",s.attr("id"))}return false}}}}}else{if(q==="click"||q==="vclick"){if(!o.hasClass("al-option")){o=o.parent()}r=o.find("span.al-value").html();if(r.length===0){r=o.find("span.al-label").html()}f.val(r);pe.focus(f);g("~!!@@#$");return false}}}});a(document).on("click touchstart",function(k){if(f.attr("aria-expanded")==="true"&&!a(k.target).is(f)){g("~!!@@#$");f.removeAttr("aria-activedescendent")}})})};a("input[list]").datalist()}(jQuery));