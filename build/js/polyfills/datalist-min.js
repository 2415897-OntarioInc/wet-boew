/*!
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * www.tbs.gc.ca/ws-nw/wet-boew/terms / www.sct.gc.ca/ws-nw/wet-boew/conditions
 */
(function(a){a.fn.datalist=function(){return a(this).each(function(c){var h=a(this),d=a("#"+h.attr("list")),f,b,g=[],e;e=function(k){var i=k.toLowerCase(),j=b.filter(function(){var m=a(this),l=m.find("span.al-value").html();if(l.length===0){l=m.find("span.al-label").html()}return(i.length===0||l.toLowerCase().indexOf(i)===0)});b.not(j).addClass("al-hide");j.removeClass("al-hide");if(j.length!==0){f.removeClass("al-hide");h.attr("aria-expanded","true")}else{f.addClass("al-hide");h.attr("aria-expanded","false")}};correctWidth=function(){f.css("min-width",h.innerWidth())};pe.resize(correctWidth);d.find("option").each(function(l){var k=a(this),j=k.attr("value"),i=k.attr("label");if(j==="undefined"){j=k.text()}g.push('<li class="al-hide al-option" tabindex="-1" id="al-option-'+c+"-"+l+'"><span class="al-value">'+(j!=="undefined"?j:"")+'</span><span class="al-label">'+(i!=="undefined"?i:"")+"</span></li>")});h.attr({role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":"wb-autolist-"+c});f=a('<ul role="listbox" id="wb-autolist-'+c+'" class="wb-autolist al-hide">'+g.join("")+"</ul>").css("min-width",h.innerWidth());b=f.find("li");h.after(f);h.on("keyup keydown click vclick",function(l){var k=l.type,i=l.keyCode,j;if(k==="keyup"){if(!(l.ctrlKey||l.altKey||l.metaKey)){if((i>47&&i<58)||(i>64&&i<91)||i===32||i===8){e(h.val())}}}else{if(k==="keydown"){if(!(l.ctrlKey||l.metaKey)){if(!l.altKey&&h.attr("aria-expanded")==="true"){if(i===9||i===27){e("~!!@@#$");h.removeAttr("aria-activedescendent");if(i===27){return false}}else{if(i===38){j=b.filter(":not(.al-hide)").last();pe.focus(j);h.attr("aria-activedescendent",j.attr("id"));return false}else{if(i===40){j=b.filter(":not(.al-hide)").eq(0).last();pe.focus(j);h.attr("aria-activedescendent",j.attr("id"));return false}else{if(i===38||i===40){e("");return false}}}}}else{if(i===38||i===40){e("");return false}}}}else{if(k==="click"||k==="vclick"){if(h.attr("aria-expanded")==="true"){e("~!!@@#$")}else{e("")}return false}}}});f.on("keyup keydown click vclick","li, span",function(n){var k=n.type,i=n.keyCode,m=a(n.target),j,o=h.val(),l;if(k==="keyup"){if(!(n.ctrlKey||n.altKey||n.metaKey)){if((i>47&&i<58)||(i>64&&i<91)||i===32||i===8){pe.focus(h);e(h.val())}else{if(i===8&&h.val().length>0){h.val(o.substring(0,o.length-1));pe.focus(h);e(h.val())}}}}else{if(k==="keydown"){if(!(n.ctrlKey||n.altKey||n.metaKey)){if(i===13){l=m.find("span.al-value").html();if(l.length===0){l=m.find("span.al-label").html()}h.val(l);pe.focus(h);e("~!!@@#$");return false}else{if(i===9||i===27){pe.focus(h);e("~!!@@#$");h.removeAttr("aria-activedescendent");if(i===27){return false}}else{if(i===38){j=m.prev();if(j.length>0){pe.focus(j);h.attr("aria-activedescendent",j.attr("id"))}else{j=b.last();pe.focus(j);h.attr("aria-activedescendent",j.attr("id"))}return false}else{if(i===40){j=m.next();if(j.length>0){pe.focus(j);h.attr("aria-activedescendent",j.attr("id"))}else{j=b.eq(0);pe.focus(j);h.attr("aria-activedescendent",j.attr("id"))}return false}else{if(i===38||i===40){e("");return false}}}}}}}else{if(k==="click"||k==="vclick"){if(!m.hasClass("al-option")){m=m.parent()}l=m.find("span.al-value").html();if(l.length===0){l=m.find("span.al-label").html()}h.val(l);pe.focus(h);e("~!!@@#$");return false}}}});a(document).on("click touchstart",function(){if(h.attr("aria-expanded")==="true"){e("~!!@@#$");h.removeAttr("aria-activedescendent")}})})};a("input[list]").datalist()}(jQuery));